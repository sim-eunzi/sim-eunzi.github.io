---
title: 이펙티브 자바스크립트 2장. 변수 스코프
date: "2021-09-07T23:53:37.121Z"
---

## 아이템 8. 전역객체의 사용을 최소화하라

자바스크립트는 전역 네임스페이스에 쉽게 변수를 만들 수 있다.  
하지만 전역변수를 정의함으로 모든 사람들과 공유하는 공통의 네임스페이스를 더럽히고,  
이름이 충돌할 만한 가능성을 만든다.

또 자바스크립트의 전역 네임스페이스는 전역 객체로도 노출되어 있다.  
전역 객체는 프로그램 최상단에서 this 키워드로 접근할 수 있는데,  
브라우저에서는 전역 window 변수에 바인딩이 되어있다.

전역객체의 사용을 제한하는게 최선이지만, **플랫폼의 기능을 탐지하기 위해서 사용**할 수 있다.  
예를 들어 ES5에는 JSON 데이터 형식을 읽고 쓰기위한 JSON 객체를 제공해주는데,  
JSON 객체가 해당 플랫폼에 제공되고 있는지 확인하는 방법으로 우리는 전역객체에서 확인 할 수 있다.

```javascript
if (!this.JSON) {
  this.JSON = {
    parse: ...,
    stringify: ...
  }
}
```

이러한 기능 탐지 방법은 웹 브라우저에서 특히 중요하다.  
엄청나게 다양한 브라우저들과, 브라우저 버전에서 동일한 코드가 실행될 수 있기 때문이다.  
견고한 프로그램을 작성하기 위해서 비교적 쉬운 방법이니 기억해두도록 하자!

## 아이템 9. 항상 지역 변수를 선언하라

전역 변수보다 문제를 일으킬만한 한 가지가 있다면,, 아마 의도하지 않은 전역 변수일 것이다.  
자바스크립트의 변수 할당 규칙이 너무 간단해서 전역변수를 실수로 만들기 쉽다.  
프로그램에서 **바인딩 되지않은 변수를 할당하면, 오류를 발생하지 않고 새로운 전역변수를 만들어 할당**한다.

```javascript
// BAD
function swap(a, i, j) {
  temp = a[i] // 전역 변수
  a[i] = a[j]
  a[j] = temp
}

// GOOD
function swap(a, i, j) {
  var temp = a[i]
  a[i] = a[j]
  a[j] = temp
}
```

우리는 이런 실수를 방지하기 위해 지역변수를 사용할 때 항상 `var`, `const`, `let`을 사용해서 선언해야한다.  
또 lint 도구를 사용해서 버그를 낼 가능성이 있는 코드를 사전에 확인하자!

## 아이템 10. with를 사용하지 마라

자바스크립트는 모든 변수를 스코프 내에서 찾을 때, 가장 안쪽에서부터 바깥쪽으로 넓혀 가면서 찾는다.

**with 선언문**은 변수 스코프를 대표하는 것처럼 객체를 처리하여, with 블록 내부에서 주어진 변수를 찾고,  
발견되지 않으면 그때 외부 스코프로 이어서 탐색한다.

```javascript
function status(info) {
  var widget = new Widget()
  with (widget) {
    setBackground("blue")
    setForeground("white")
    setText("Status: " + info)
    show()
  }
}
```

하나의 객체에서 여러 메서드를 호출해야 하는데, 해당 객체에 대한 참조를 반복할 필요가 없는 경우에는 with를 사용하는게 편리하다.

with는 객체에서 프로퍼티를 추출하고, 블록 내의 지역 변수로 바인딩하는데 엄청 간단하고 쉬워보인다.  
하지만 실제로 기대하는대로 동작하지 않는데,,

`setBackground`, `setText` 와 같이 with 객체의 프로퍼티로 참조하기를 기대하는 변수와,  
외부의 변수 바인딩으로 참조하기를 바라는 `info`와 같은 변수가 있다.  
하지만 우리는 코드만 봐서는 이 두 종류의 변수를 구별할 방법이 없고 그냥 변수처럼 보인다.

변수 스코프와 객체 네임스페이스 사이의 충돌은 with 블록을 불일정하게 만든다.  
widget 객체가 info 프로퍼티를 가지게 된다면..?  
status 함수는 갑자기 info 파라미터 대신에 객체 내부의 info 프로퍼티를 사용하게 된다.

그 밖에도 어디선가 런타임시 Widget의 prototype 객체에 info 프로퍼티를 추가할 수 있고,  
이렇게 되면 status 함수는 예측불가능한 상황이 되버린다.

자바스크립트의 스코프는 효율적인 내부 데이터 구조로 표현될 수 있고, 변수 탐색이 빠르게 수행될 수 있지만,  
with 블록은 본문의 모든 변수를 찾기 위해 **프로토타입 체인**을 탐색하고,  
이로 인해 일반적인 블록보다 현저히 느리게 실행될 것이다.

이런 경우는 with를 대안할 대체 기능은 없지만, 객체를 단순히 짧은 이름의 변수로 바인딩하는게 최선의 방안이다.

```javascript
function status(info) {
  var w = new Widget()
  w.setBackground("blue")
  w.setForeground("white")
  w.setText("Status: " + info)
  w.show()
}
```

이 예제의 동작은 예측하기 쉽고, 어떤 변수 참조도 객체 w의 내용에 신경쓰지 않는다.  
어떤 코드가 Widget의 프로토타입을 수정해도 status 함수는 기대한 대로 동작할 것이다.

